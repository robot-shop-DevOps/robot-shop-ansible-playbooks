- name: Add OpenResty repository
  ansible.builtin.apt_repository:
    repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/openresty.gpg] http://openresty.org/package/ubuntu {{ ansible_lsb.codename }} main"
    state: present
    filename: openresty
  register: openresty_repo

- name: Update apt cache if repo changed
  ansible.builtin.apt:
    update_cache: yes
  when: openresty_repo.changed

- name: Show OpenResty repo file
  ansible.builtin.command: cat /etc/apt/sources.list.d/openresty.list
  changed_when: false

- name: Show APT sources that mention openresty
  ansible.builtin.command: grep -R openresty /etc/apt/
  changed_when: false

- name: Show openresty availability
  ansible.builtin.command: apt-cache policy openresty
  changed_when: false

- name: Show raw Packages index (if any)
  ansible.builtin.shell: |
    ls -l /var/lib/apt/lists | grep openresty || true
  changed_when: false